rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
pacman::p_load(dplyr, tidyr, data.table, ggplot2, sf, rnaturalearth, rnaturalearthdata)
################################
#maps for paper
################################
#setwd("~/RTSL")
df<-read.csv("../../model/covfxn2.csv", stringsAsFactors = F)
#df<-covfxn
df$reach_base[df$reach_base==Inf]<-2065
ssd<-df%>%filter(location =="Sudan")%>%
mutate(iso3="SSD", location = "South Sudan")
df<-bind_rows(df, ssd)
library("ggplot2")
theme_set(theme_bw())
library("sf")
library("rnaturalearth")
library("rnaturalearthdata")
world <- ne_countries(scale = "medium", returnclass = "sf")
class(world)
world<-left_join(world, df%>%rename(iso_a3 = iso3)%>%filter(Year==2050), by="iso_a3")
world$achievebyb[world$reach_75<=2022]<-"Already achieved"
world$achievebyb[world$reach_75>2022 & world$reach_75<=2030]<-"2023-2030"
world$achievebyb[world$reach_75>2030 & world$reach_75<=2040]<-"2031-2040"
world$achievebyb[world$reach_75>2040 & world$reach_75<=2050]<-"2041-2050"
world$achievebyb[world$reach_75>2050]<-"After 2050"
world$achievebyb <- factor(world$achievebyb, levels = c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050"))
any(world$reach_75>2050)
d<-ggplot(data = world) +
geom_sf(aes(fill = factor(achievebyb))) +
theme_bw()+
scale_fill_manual(values = c("#2F635A","#b9d780", "#feea83",
"#faa175", "#f8696b"),
drop=FALSE,
labels = c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050"),
name= "Projected timeframe for \nachieving 80-80-80 target")+
theme(legend.position = "right")+
ggtitle("Progress scenario")
d
world$achievebyb2[world$reach_975<=2022]<-"Already achieved"
world$achievebyb2[world$reach_975>2022 & world$reach_975<=2030]<-"2023-2030"
world$achievebyb2[world$reach_975>2030 & world$reach_975<=2040]<-"2031-2040"
world$achievebyb2[world$reach_975>2040 & world$reach_975<=2050]<-"2041-2050"
world$achievebyb2[world$reach_975>2050]<-"After 2050"
world$achievebyb2 <- factor(world$achievebyb2, levels = c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050"))
any(world$reach_975>2040)
any(world$reach_975>2050)
e<-ggplot(data = world) +
geom_sf(aes(fill = factor(achievebyb2))) +
theme_bw()+
scale_fill_manual(values = c("#2F635A","#b9d780", "#feea83",
"#faa175", "#f8696b","#9B2226"),
name= "Projected timeframe for \nachieving 80-80-80 target")+
theme(legend.position = "right")+
ggtitle("Aspirational scenario")
e
world$achievebybs[world$refwsalt<=2022]<-"Already achieved"
world$achievebybs[world$refwsalt>2022 & world$refwsalt<=2030]<-"2023-2030"
world$achievebybs[world$refwsalt>2030 & world$refwsalt<=2040]<-"2031-2040"
world$achievebybs[world$refwsalt>2040 & world$refwsalt<=2050]<-"2041-2050"
world$achievebybs[world$refwsalt>2050]<-"After 2050"
world$achievebybs <- factor(world$achievebybs, levels = c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050"))
b<-ggplot(data = world) +
geom_sf(aes(fill = factor(achievebybs))) +
theme_bw()+
scale_fill_manual(values = c("#2F635A", "#b9d780", "#feea83",
"#faa175", "#f8696b", "#9B2226"),
name= "Projected timeframe for \nachieving 80-80-80 target")+
theme(legend.position = "right")+
ggtitle("Progress scenario")
#ggsave("figures/map_refwsalt.png", height=6, width=10)
b
world$achievebyb2s[world$aspwsalt<=2022]<-"Already achieved"
world$achievebyb2s[world$aspwsalt>2022 & world$aspwsalt<=2030]<-"2023-2030"
world$achievebyb2s[world$aspwsalt>2030 & world$aspwsalt<=2040]<-"2031-2040"
world$achievebyb2s[world$aspwsalt>2040 & world$aspwsalt<=2050]<-"2041-2050"
world$achievebyb2s[world$aspwsalt>2050]<-"After 2050"
world$achievebyb2s <- factor(world$achievebyb2s, levels = c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050"))
c<-ggplot(data = world) +
geom_sf(aes(fill = factor(achievebyb2s))) +
theme_bw()+
scale_fill_manual(values = c("#2F635A","#b9d780", "#feea83",
"#faa175", "#f8696b","#9B2226"),
labels = c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050"),
drop=FALSE,
name= "Projected timeframe for \nachieving 80-80-80 target")+
theme(legend.position = "right")+
ggtitle("Aspirational scenario")
#ggsave("figures/map_aspwsalt.png", height = 6, width=10)
c
world$achieveby00[world$reach_base<=2022]<-"Already achieved"
world$achieveby00[world$reach_base>2022 & world$reach_base<=2030]<-"2023-2030"
world$achieveby00[world$reach_base>2030 & world$reach_base<=2040]<-"2031-2040"
world$achieveby00[world$reach_base>2040 & world$reach_base<=2050]<-"2041-2050"
world$achieveby00[world$reach_base>2050]<-"After 2050"
world$achieveby00[world$reach_base>2050]
world$achieveby00 <- factor(world$achieveby00, levels = c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050"))
leg<-world[1:6,]
leg$achieveby00<-factor(c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050", NA),
levels = c("Already achieved", "2023-2030", "2031-2040",
"2041-2050","After 2050"))
legend1<-get_legend(
ggplot(data = leg) +
geom_sf(aes(fill = factor(achieveby00))) +
theme_bw()+
theme(legend.position = 'right')+
scale_fill_manual(values = c("#2F635A","#b9d780", "#feea83",
"#faa175", "#f8696b","#9B2226"),
name = "Projected timeframe for \nachieving 80-80-80 target")
)
unique(world$achieveby00)
a<-ggplot(data = world) +
geom_sf(aes(fill = factor(achieveby00))) +
theme_bw()+
scale_fill_manual(values = c("#2F635A","#b9d780", "#f8696b"))+
ggtitle("Business as usual scenario")
a
library(ggpubr)
legend1<-get_legend(
ggplot(data = leg) +
geom_sf(aes(fill = factor(achieveby00))) +
theme_bw()+
theme(legend.position = 'right')+
scale_fill_manual(values = c("#2F635A","#b9d780", "#feea83",
"#faa175", "#f8696b","#9B2226"),
name = "Projected timeframe for \nachieving 80-80-80 target")
)
a<- a + theme(legend.position = 'none')
b<- b + theme(legend.position = 'none')
c<- c + theme(legend.position = 'none')
ggarrange(a, legend.grob=legend1, legend='right')
ggsave("../../output/map1.jpg", height = 6, width=10, dpi=1200)
ggsave( "../output/map1.eps", device='eps', width=10, height=6)
a2<-ggarrange(a, legend.grob=legend1, legend='right')
a2
ggsave(a2, "../output/map1.eps", device='eps', width=10, height=6)
ggsave(a2, "../output/map1.eps", device='eps', width=10, height=6)
ggsave( "../output/map1.tiff", device='tiff', width=10, height=6)
ggsave( "../output/map1.tiff", device=grDevices::tiff, width=10, height=6)
ggsave( "../output/map1.tiff", device=grDevices::tiff)
dev.off()
ggsave( "../output/map1.tiff", device=grDevices::tiff)
dev.off()
tiff("../output/map1.tiff")
ggsave( "../output/map1.tiff", device=grDevices::tiff)
ggsave( "../../output/map1.tiff", device='tiff', width=10, height=6)
ggarrange(a, legend.grob=legend1, legend='right')
ggarrange(a, legend.grob=legend1, legend='right')
a
